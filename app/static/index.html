<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Predictor</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 50px auto; }
    input, select { display: block; margin: 10px 0; width: 100%; padding: 8px; }
    button { padding: 10px 15px; margin-top: 10px; }
    .result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Loan Approval Predictor</h1>
  <form id="loanForm">
    <input type="number" name="person_age" placeholder="Person Age" required>
    <input type="number" name="person_income" placeholder="Income" step="0.01" required>
    <select name="person_home_ownership" required>
      <option value="">Home Ownership</option>
      <option value="RENT">RENT</option>
      <option value="MORTGAGE">MORTGAGE</option>
      <option value="OWN">OWN</option>
      <option value="OTHER">OTHER</option>
    </select>
    <input type="number" name="person_emp_length" placeholder="Employment Length (years)" step="0.1" required>
    <select name="loan_intent" required>
      <option value="">Loan Intent</option>
      <option value="PERSONAL">PERSONAL</option>
      <option value="EDUCATION">EDUCATION</option>
      <option value="VENTURE">VENTURE</option>
      <option value="MEDICAL">MEDICAL</option>
    </select>
    <select name="loan_grade" required>
      <option value="">Loan Grade</option>
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
    </select>
    <input type="number" name="loan_amnt" placeholder="Loan Amount" step="0.01" required>
    <input type="number" name="loan_int_rate" placeholder="Loan Interest Rate" step="0.01" required>
    <input type="number" name="loan_percent_income" placeholder="Loan Percent of Income" step="0.01" required>
    <select name="cb_person_default_on_file" required>
      <option value="">Default on File?</option>
      <option value="Y">Yes</option>
      <option value="N">No</option>
    </select>
    <input type="number" name="cb_person_cred_hist_length" placeholder="Credit History Length (months)" required>

    <button type="submit">Predict</button>
  </form>

  <div class="result" id="result"></div>

  <script>
    const form = document.getElementById('loanForm');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const payload = Object.fromEntries(formData.entries());

      // Convert numeric fields to numbers
      payload.person_age = Number(payload.person_age);
      payload.person_income = Number(payload.person_income);
      payload.person_emp_length = Number(payload.person_emp_length);
      payload.loan_amnt = Number(payload.loan_amnt);
      payload.loan_int_rate = Number(payload.loan_int_rate);
      payload.loan_percent_income = Number(payload.loan_percent_income);
      payload.cb_person_cred_hist_length = Number(payload.cb_person_cred_hist_length);

      try {
        const res = await fetch('https://loanpredictor-wntj.onrender.com/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error('Network response was not ok');

        const data = await res.json();
        resultDiv.textContent = `Loan Status: ${data.loan_status === 1 ? 'Approved ✅' : 'Rejected ❌'} | Probability: ${data.probability.toFixed(2)}`;
      } catch (err) {
        resultDiv.textContent = `Error: ${err.message}`;
      }
    });
  </script>
</body>
</html>
